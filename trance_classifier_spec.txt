
==========================================
TRANCE CLASSIFIER – SPEC FILE
==========================================

Version: 6.0
Date: 2025-11-20

==========================================
1. מטרת המערכת
==========================================
מערכת לזיהוי תת־סגנון של מוזיקת טראנס (Goa / Psy / Dark) באמצעות שילוב:
- ספקטרוגרמות תמונה (299×299)
- מטריצות אמבדינג אודיו (10×68)
- מודל EfficientNetB0 + GRU + Attention
- אימון דו־שלבי כולל Fine-Tuning

==========================================
2. דרישות מערכת
==========================================
2.1 זמן ריצה:
    המערכת תדפיס זמן ריצה/התקדמות לכל שלב באמצעות:
    - training_progress.txt (התקדמות לפי אפוק)
    - לוג סופי בקונסול לגבי סיום האימון.

2.2 שמירת ביצועים:
    לכל מודל חדש תיווצר תיקייה בנתיב:
        models/vX/
    ובתוכה:
        model.h5 — המודל המאומן (לאחר Fine-Tuning).
        accuracy.png — גרף דיוק.
        loss.png — גרף הפסד.
        confusion_matrix.png — מטריצת בלבול.
        report.txt — דוח סיווג מלא.
        training_log.txt — סיכום אימון (זמנים, class_weights, ביצועים, אפוקים).
        training_progress.txt — לוג התקדמות לפי אפוק (accuracy/loss/val).

2.3 latest.h5:
    תמיד יכיל את הגרסה האחרונה של המודל לאחר Fine-Tuning.

2.4 ניהול גרסאות:
    - גרסת המודל vX מחושבת אוטומטית לפי תיקיות קיימות ב־models/ (v1, v2, v3, ...).
    - גרסה חדשה תמיד תהיה max(X) + 1.

2.5 טיפול בשגיאות:
    - אם לא נטענות כלל דגימות – תיזרק RuntimeError.
    - אם embedding לא בגודל (10×68) – תופיע אזהרה והדגימה תדלג.

==========================================
3. מבנה הדאטה (DATA/)
==========================================
data/
    goa/
    psy/
    dark/

כל track_id מכיל:
- 6 קטעים בני 10 שניות
- part_X.png (ספקטרוגרמה 299×299 RGB)
- part_X.npy (מטריצה 10×68)

חלוקת הדאטה:
- shuffle מלא
- 80% אימון
- 20% ולידציה

==========================================
4. יצירת ספקטרוגרמה
==========================================
- mel-spectrogram עם 128 מסננים
- המרה ל-dB
- שמירה כ־299×299
- ללא שוליים
- הקלט למודל EfficientNetB0

==========================================
5. הפקת פיצ'רים – מטריצה (10×68)
==========================================
10 חלונות × 1 שניה כל אחד.
פיצ'רים אפשריים:
- MFCC
- Centroid / Bandwidth / Rolloff
- Zero Crossing
- RMS
- Tonnetz
- Chroma
- BPM
- סטטיסטיקות

אם הצורה != (10, 68) → דגימה נזרקת.

==========================================
6. מבנה המודל
==========================================

A. זרם תמונה:
- EfficientNetB0 קפוא
- GlobalAveragePooling
- Dense(128)

B. זרם אודיו:
- GRU(128, return_sequences=True)
- Attention
- GRU(64)
- Dense(64)

C. שילוב:
- Concatenate
- Dense(128) → Dropout(0.4)
- Dense(64)
- Dense(3, softmax)

==========================================
7. אימון
==========================================
שלב 1:
- EfficientNet קפוא
- lr=1e-4
- Cosine LR + Warmup
- Batch size = 32
- EarlyStopping
- class_weight מאוזן

שלב 2:
- פתיחת ~20 שכבות אחרונות של EfficientNet
- lr=1e-5
- Cosine LR + Warmup
- אימון 3–8 אפוקים

סיום:
- שמירת גרסה בתיקייה: models/vX/model.h5
- latest.h5 מתעדכן

==========================================
8. תוצאות צפויות
==========================================
Baseline: 50–57%
עם Attention + FT: 58–65%+
גרסה 6 קרובה ל־60%+ בממוצע.

==========================================
9. ויזואליזציה ודו"חות
==========================================
analysis/ בתיקיית vX יכיל:
- confusion_matrix.png
- report.txt
- accuracy.png
- loss.png
- training_log.txt

==========================================
10. עיצוב גרפים
==========================================
- seaborn style whitegrid
- שמירה כ־PNG עם tight_layout
